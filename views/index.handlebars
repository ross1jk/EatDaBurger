<div class="jumbotron jumbotron-fluid">
	<div class="container">
		<h1 class="display-4">Eat-Da-Burger</h1>
		<p class="lead">Were ready to track all of your burger needs!</p>
	</div>
</div>

<div class="container">
	<div class="row">

		<div class="col-6">

			<h2>Burgers to Eat</h2>
			<ul>
				{{#each burgers}}
				{{#unless devoured}}
				{{> burgers/burger-block devoured=true}}
				{{/unless}}
				{{/each}}
			</ul>
		</div>


		<div class="col-6">
			<h2>Burgers Devoured</h2>
			<ul>
				{{#each burgers}}
				{{#if devoured}}
				{{> burgers/burger-block devoured=false}}
				{{/if}}
				{{/each}}
			</ul>
		</div>


		<div class="row">
			<div class="card" id="addBurgerCard">
				<div class="card-body">
					<h2 id="cardheading">Add-A-Burger</h2>

					<form id="addBurger">
						<input type="text" name="burger_name" id="burger_name">
						<button type="submit" class="btn btn-info">ADD BURGER</button>
					</form>
				</div>
			</div>
		</div>

	</div>

	<script type="text/javascript">
		document.addEventListener('DOMContentLoaded', (event) => {
			if (event) {
				console.info('DOM loaded');
			};


			// create
			const submitBurgerBtn = document.getElementById('addBurger');
			if (submitBurgerBtn) {
				submitBurgerBtn.addEventListener('submit', (e) => {
					e.preventDefault();
					const newBurger = {
						burger_name: document.getElementById('burger_name').value.trim(),
					};
					console.log(newBurger);
					// Send POST request to create a new quote
					fetch('/api/burgers', {
						method: 'POST',
						headers: {
							'Accept': 'application/json',
							'Content-Type': 'application/json',
						},
						// make sure to serialize the JSON body
						body: JSON.stringify(newBurger),
					}).then(() => {
						// Empty the form
						document.getElementById('burger_name').value = '';
						console.log('Added a new burger!');
						location.reload();
					});
				});
			}

			// UPDATE
			const changeBurgerBtns = document.querySelectorAll('.change-devoured');

			// Set up the event listener for the create button
			if (changeBurgerBtns) {
				changeBurgerBtns.forEach((button) => {
					button.addEventListener('click', (e) => {
						const id = e.target.getAttribute('data-id');
						const newDevour = e.target.getAttribute('data-devoured');
						console.log(newDevour); 
						const newDevourState = {
							devoured: newDevour,
						};

						fetch(`/api/burgers/${id}`, {
							method: 'PUT',
							headers: {
								Accept: 'application/json',
								'Content-Type': 'application/json',
							},

							// make sure to serialize the JSON body
							body: JSON.stringify(newDevourState),
						}).then((response) => {
							// Check that the response is all good
							// Reload the page so the user can see the new quote
							if (response.ok) {
								console.log(`changed devour to: ${newDevour}`);
								location.reload('/');
							} else {
								alert('something went wrong!');
								console.log(response + " " + newDevourState); 
							}
						});
					});
				});
			}

		});

	</script>